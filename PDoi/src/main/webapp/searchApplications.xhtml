<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:jsf="http://xmlns.jcp.org/jsf" 
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:ibg="http://java.sun.com/jsf/composite/components">

<ui:composition template="/templateExt/mainExt.xhtml">

	
	<ui:define name="menu-items">
		<ui:include src="/include/menuExt.xhtml" />
	</ui:define>

	<ui:define name="content">
	
		<style>			
			
			.ui-link {
				  color:#039be5;				
				}			 
			
			.ui-link:hover {text-decoration:underline !important; color:#039be5; cursor: pointer;}
			.ui-datagrid-content {
				border: none;
			}
		</style>	
	
		<h:form id="appFilterForm">
			<p:defaultCommand target="btnSearch"/>
			<p:focus id="focusID" for="text" />
			
			<p:importConstants type="indexbg.pdoi.system.Constants" var="IBConstants" className="indexbg.pdoi.system.Constants"/>
			<p:importConstants type="com.indexbg.system.SysConstants" var="IBConstantsSys" className="com.indexbg.system.SysConstants" />

			<div class="container">

				<p:outputPanel id="panelData">	
						
					<br />
					
					<p:panel  >
						<div class="ui-g">
							
			
							<div class="ui-g-12 ui-md-2 ui-lg-2 cc-right">
								<h:outputText value="#{labels['general.text']}: " />
							</div>
							<div class="ui-g-12 ui-md-10 ui-lg-10">											
    							<p:inputText value="#{searchApplications.text}" id="text" style="width:96%;"/>                         
							</div>
							
							<div class="ui-g-12 ui-md-2 ui-lg-2 cc-right" >
								<h:outputText value="#{labels['general.period']}:"/>
							</div>
							<div class="ui-g-12 ui-md-2 ui-lg-2">
								<p:selectOneMenu id="idPer" height="300px" value="#{searchApplications.period}" style="width:250px;" >
		                             <f:selectItem value="#{null}" itemValue="#{null}"/>          
		                             <f:selectItems  value="#{systemData.getSysClassification(IBConstantsSys.CODE_CLASSIF_PERIOD_NOFUTURE, searchApplications.today, searchApplications.currentLang, searchApplications.userID)}"  
		                                    var="clPer" itemLabel="#{clPer.tekst}" itemValue="#{clPer.code}" />
		                             <p:ajax event="change" update="idPer dateOt dateDo"  listener="#{searchApplications.changePeriod()}"   />   
		                        </p:selectOneMenu>
	                        </div>
	                                
	                        <div class="ui-g-12 ui-md-2 ui-lg-2 cc-right" >
								<h:outputText value="#{labels['general.dataOt']}:"/>
							</div>
							<div class="ui-g-12 ui-md-3 ui-lg-3">
									 <p:calendar id="dateOt" pattern="dd.MM.yyyy" mask="true"  showOn="button" 
											timeZone="#{searchApplications.timeZone}" size="10" locale="bg" 
								         	style="font-size:12px;"   value="#{searchApplications.dateFrom}" label="#{labels['publ.dateFrom']}"
								          	styleClass="form-control #{searchApplications.hasMessages('appFilterForm:dateOt') ? 'cc-red ': '' }" >
								          	
								      </p:calendar>
								      <p:message for="dateOt" showDetail="true" showSummary="true" display="tooltip"/>
							</div>
							
							<div class="ui-g-12 ui-md-1 ui-lg-1 cc-right" >
										<h:outputText value="#{labels['general.dataDo']}:"/>
							</div>
							<div class="ui-g-12 ui-md-2 ui-lg-2">
								<p:calendar id="dateDo" pattern="dd.MM.yyyy" mask="true" showOn="button" 
									timeZone="#{searchApplications.timeZone}" size="10" locale="bg" 
						         	style="font-size:12px;"  value="#{searchApplications.dateTo}" label="#{labels['publ.dateTo']}"   
						          	styleClass="form-control #{searchApplications.hasMessages('appFilterForm:dateDo') ? 'cc-red' : '' }" >
						          </p:calendar>  	
							     <p:message for="dateDo" showDetail="true" showSummary="true" display="tooltip"/> 
							</div> 
							
							<div class="ui-g-12 ui-md-2 ui-lg-2 cc-right" >
								<h:outputText value="#{labels['general.status']}: " />
							</div>
							<div class="ui-g-12 ui-md-2 ui-lg-2">
								<p:selectOneMenu value="#{searchApplications.status}" height="300px" id="status" autoWidth="false" style="width:250px;">                                     
                               		<f:selectItem itemLabel="" itemValue="" />
                                    <f:selectItems value="#{systemData.getSysClassification(IBConstants.CODE_SYSCLASS_STATUS_APPLICATION, searchApplications.today, searchApplications.currentLang, searchApplications.userID)}" 
                                    			   var="evR" itemLabel="#{evR.tekst}" itemValue="#{evR.code}" />			                                    
                                </p:selectOneMenu>											                        
							</div>
							
							<div class="ui-g-12 ui-md-2 ui-lg-2 cc-right" >
							
								<h:outputText value="#{labels['publ.tematika']}: " />
							
							</div>
							<div class="ui-g-12 ui-md-6 ui-lg-6">
							
								<p:inputText value="#{searchApplications.tematika}"  id="tematika" readonly="true" style="width:90%" />
							
								<ibg:selectManyModal  
											header="#{labels['publ.izbThemas']}"   
											userId="#{searchApplications.userID}"  
											lang="#{searchApplications.currentLang}"   
							 	            saveStateTree="true"  
							 	            withBtnClear="false"
							 		        codeClassif="#{IBConstants.CODE_SYSCLASS_THEMAS}"     
							 		        update="appFilterForm:tematika"  
							 		        selectedCodes="#{searchApplications.selectedThemas}" 
							 		        selectedText="#{searchApplications.tematika}"
							 		        modal="true"
							 		        id="idManyMT"
							 		        expanded="false"
							 		        sortByName="true"
							 		        isSelectNode="false"
							 		        showRadioBtn="true" />										                        
							</div>
							
							<div class="ui-g-12 ui-md-2 ui-lg-2 cc-right">
								<h:outputText value="#{labels['responseSubjects.title']}: "/>
							</div>
	
							<div class="ui-g-12 ui-md-10 ui-lg-10">							
							<p:inputText value="#{searchApplications.zadaljenSubText}" id="respSubj" readonly="true" style="width:94%;"/>   
		                	<ibg:selectOneModal  header="#{labels['responseSubjects.title']}" userId="#{searchApplications.userID}" lang="#{searchApplications.currentLang}" 
					 	 			saveStateTree="true" isSelectNode="true" withBtnClear="true" codeClassif="#{IBConstants.CODE_SYSCLASS_ADM_REGISTRY}"     
					 				update="appFilterForm:respSubj" selectedCode="#{searchApplications.responseSubj}" selectedText="#{searchApplications.zadaljenSubText}"  />	    							
							
							</div>
								
							<div class="ui-g-12 ui-md-2 ui-lg-2 cc-right" >
								<h:outputText value="#{labels['app.nomerZaiavlenie']}: "/>
							</div>

							<div class="ui-g-12 ui-md-2 ui-lg-10">											
    							<p:inputText id="nomer" value="#{searchApplications.nomer}" style="width:250px"/>                         
							</div>
							<div class="ui-g-12 ui-md-2 ui-lg-2 cc-right">
				 				<p:commandButton action="#{searchApplications.actionClear()}" value="#{labels['general.clear']}" update="appFilterForm:panelData" id="btnClear" /> 
						 	</div>						 
						    <div class="ui-g-12 ui-md-2 ui-lg-10 cc-right" >
						        <p:commandButton action="#{searchApplications.actionSearch()}" value="#{labels['general.search']}" icon="fa fa-search" update="appFilterForm:panelData" id="btnSearch" >
						       		<f:param name="param" value="#{param}" />	
						        </p:commandButton>
						    </div>
						    		
						</div>
					
					</p:panel>	
					 
					<br />
					
					
					<ui:decorate template="/templates/panel.xhtml">
						<ui:define name="panel-header">
							<h:outputText value="#{labels['adminApp.title']}: #{searchApplications.appList.getRowCount()}" />
						</ui:define>
						<ui:define name="panel-content">
					
					
			 						 	
					 	 <p:dataGrid id="tbl" var="row" rendered="#{searchApplications.appList!=null}" columns="1" layout="grid"
							value="#{searchApplications.appList}" lazy="true" rows="10"
							rowIndexVar="idx" sortMode="single" reflow="true"
							emptyMessage=""
							paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
							rowsPerPageTemplate="15,20,30" paginatorPosition="bottom"
							paginator="true" style="margin-bottom:20px; border:0px" >
							
							  <p:panel >
						            <h:panelGrid columns="1" style="width:100%">
						              
							           <p:link  outcome="applicationView.jsf" >
											<p:outputLabel  value="#{row[0].request150}" style="color:#039be5;font-size:large"/>
												<f:param name="idObj" value="#{row[0].id}" />
									   </p:link>
										
						 			   
						 			     <h:panelGroup>
							                <h:outputText value="#{systemData.decodeItem(IBConstants.CODE_SYSCLASS_ADM_REGISTRY, row[0].responseSubjectId, searchApplications.currentLang, searchApplications.today, searchApplications.userID)}" />
							 	             	
										    |
										   <h:outputText value="#{labels['app.nomerZaiavlenie']}: "/>
										   <h:outputText   value="#{row[0].applicationUri}" />
						 	             </h:panelGroup>
						 	            <h:panelGroup>
						 	                <h:outputText value="#{labels['general.dataPodavane']}: " />
						 	                <h:outputText   value="#{row[0].dateReg}" >
						 	                	<f:convertDateTime type="date" pattern="dd.MM.yyyy" timeZone="#{searchApplications.timeZone}"/>
						 	                </h:outputText>
						 	                <p:spacer width="10" />
											<h:outputText styleClass="fa fa-eye"   />
											<p:spacer width="5" />
											<h:outputText   value="#{row[0].numberOfVisits}" />
											  	
										    |
										    <h:outputText value="#{labels['general.status']}: " />
										   <h:outputText value="#{systemData.decodeItem(IBConstants.CODE_SYSCLASS_STATUS_APPLICATION, row[0].status, searchApplications.currentLang, searchApplications.today, searchApplications.userID)}" />
											<h:outputText value="   #{row[1]}"/>
						                </h:panelGroup>
						            </h:panelGrid>
						      </p:panel>

						</p:dataGrid>

			        	</ui:define>
			        </ui:decorate>
				</p:outputPanel>

			</div>
			
		</h:form>

	</ui:define>

</ui:composition>

</html>